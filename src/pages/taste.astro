---
import MainLayout from "../layouts/MainLayout.astro";
import { TasteProfileWrapper } from "../components/dashboard/TasteProfileWrapper";
import { TasteService } from "../lib/services/taste.service";

// Logika sprawdzania użytkownika
const user = Astro.locals.user;
const userId = user?.id;

// Przekierowanie niezalogowanych użytkowników
if (!userId) {
  return Astro.redirect("/auth/login");
}

// Fetch user taste server-side for initial data
const initialTaste = await TasteService.getUserTaste(userId);
---

<MainLayout title="Twój Profil Gustu - getTaste">
  <div class="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 text-white">
    <TasteProfileWrapper userId={userId} initialData={initialTaste} client:only="react" />
  </div>
</MainLayout>

<script>
  // This ensures the component is hydrated properly with client-side navigation
  document.addEventListener('astro:page-load', () => {
    document.querySelectorAll('[data-reactroot]').forEach(el => {
      el.removeAttribute('data-reactroot');
    });
  });
</script>
